<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê´€ë¦¬ì í˜ì´ì§€</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
    <style>
        <style> :root {
            --primary-color: #003057;
            --secondary-color: #6c757d;
            --success-color: #28a745;
            --danger-color: #dc3545;
            --bg-color: #f4f7f9;
            --card-bg: #ffffff;
            --border-color: #e9ecef;
            --font-base: 'Noto Sans KR', sans-serif;
        }

        body {
            font-family: var(--font-base);
            background: var(--bg-color);
            padding: 20px;
            color: #333;
            font-size: 15px;
            /* ê¸°ë³¸ í°íŠ¸ í¬ê¸° í†µì¼ */
        }

        .container {
            max-width: 1100px;
            margin: 0 auto;
            background: var(--card-bg);
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }

        /* Header & Buttons */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--primary-color);
        }

        .header h2 {
            font-size: 1.5rem;
            color: var(--primary-color);
            margin: 0;
            font-weight: 700;
        }

        .btn {
            display: inline-flex;
            justify-content: center;
            align-items: center;
            padding: 0.5rem 1rem;
            font-size: 0.95rem;
            font-weight: 500;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            text-decoration: none;
            transition: opacity 0.2s;
            height: 38px;
            box-sizing: border-box;
        }

        .btn:hover {
            opacity: 0.9;
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
        }

        .btn-secondary {
            background: var(--secondary-color);
            color: white;
        }

        .btn-success {
            background: var(--success-color);
            color: white;
        }

        .btn-danger {
            background: var(--danger-color);
            color: white;
        }

        .btn-outline {
            background: white;
            border: 1px solid #ccc;
            color: #555;
        }

        /* Search & Filter Section */
        .filter-section {
            background: #f8f9fa;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 25px;
        }

        .filter-group-title {
            font-size: 0.9rem;
            font-weight: 700;
            color: #555;
            margin-bottom: 8px;
            display: block;
        }

        .form-control,
        .form-select {
            height: 38px;
            padding: 6px 12px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 0.95rem;
        }

        /* Applicant Card */
        .card {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            margin-bottom: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.02);
            position: relative;
        }

        .card-header {
            background: #f1f3f5;
            padding: 12px 20px;
            border-bottom: 1px solid var(--border-color);
            border-radius: 8px 8px 0 0;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .card-body {
            padding: 20px;
            display: flex;
            gap: 20px;
        }

        .applicant-info {
            flex: 1;
        }

        .applicant-photo {
            width: 120px;
            height: 160px;
            background: #eee;
            border: 1px solid #ddd;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #aaa;
            font-size: 0.8rem;
            flex-shrink: 0;
        }

        .applicant-photo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* Info Labels */
        .info-row {
            margin-bottom: 8px;
            font-size: 0.95rem;
            line-height: 1.5;
        }

        .label-badge {
            display: inline-block;
            width: 70px;
            font-weight: 600;
            color: #666;
        }

        .data-val {
            color: #333;
        }

        .highlight {
            color: #0056b3;
            font-weight: 600;
        }

        .badge {
            padding: 0.25em 0.6em;
            font-size: 0.75em;
            font-weight: 700;
            color: #fff;
            border-radius: 0.25rem;
            vertical-align: text-top;
        }

        /* Table */
        .career-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            font-size: 0.9rem;
        }

        .career-table th {
            background: #f8f9fa;
            color: #555;
            padding: 8px;
            border: 1px solid #dee2e6;
        }

        .career-table td {
            padding: 8px;
            border: 1px solid #dee2e6;
            text-align: center;
        }

        /* Memo */
        .memo-box {
            margin-top: 15px;
            padding: 15px;
            background: #fffcf0;
            border: 1px dashed #e0dcbf;
            border-radius: 6px;
        }

        .memo-textarea {
            width: 100%;
            height: 50px;
            border: 1px solid #e0dcbf;
            background: transparent;
            resize: none;
            padding: 5px;
            font-size: 0.9rem;
        }

        /* Pagination */
        .pagination {
            display: flex;
            justify-content: center;
            gap: 5px;
            margin-top: 30px;
        }

        .page-link {
            display: inline-flex;
            width: 36px;
            height: 36px;
            justify-content: center;
            align-items: center;
            border: 1px solid #dee2e6;
            color: var(--primary-color);
            background: white;
            border-radius: 4px;
            text-decoration: none;
            font-weight: 600;
        }

        .page-link.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .page-link:hover:not(.active) {
            background: #e9ecef;
        }
    </style>
    <script>
        function toggleAll(source) {
            document.getElementsByName('selected_ids').forEach(checkbox => {
                checkbox.checked = source.checked;
            });
        }

        function goPage(page) {
            const form = document.querySelector('form[action="{{ url_for("admin.master_view") }}"]');

            // í˜ì´ì§€ ì…ë ¥ í•„ë“œê°€ ì—†ìœ¼ë©´ ìƒì„±
            let pageInput = form.querySelector('input[name="page"]');
            if (!pageInput) {
                pageInput = document.createElement('input');
                pageInput.type = 'hidden';
                pageInput.name = 'page';
                form.appendChild(pageInput);
            }
            pageInput.value = page;
            form.submit();
        }

        async function saveMemo(appId) {
            const memoText = document.getElementById(`memo-${appId}`).value;
            const btn = document.getElementById(`btn-memo-${appId}`);
            const originalText = btn.innerText;

            btn.innerText = "ì €ì¥...";
            btn.disabled = true;

            const formData = new FormData();
            formData.append('memo', memoText);
            formData.append('csrf_token', '{{ csrf_token() }}');

            try {
                const response = await fetch(`/update_memo/${appId}`, {
                    method: 'POST', body: formData
                });
                const result = await response.json();
                if (result.success) {
                    btn.innerText = "ì™„ë£Œ";
                    btn.style.background = "var(--success-color)";
                    setTimeout(() => {
                        btn.innerText = originalText;
                        btn.style.background = ""; // reset
                        btn.disabled = false;
                    }, 1500);
                } else {
                    alert("ì‹¤íŒ¨: " + result.message);
                    btn.disabled = false;
                    btn.innerText = originalText;
                }
            } catch (error) {
                console.error(error);
                alert("ì˜¤ë¥˜ ë°œìƒ");
                btn.disabled = false;
                btn.innerText = originalText;
            }
        }
    </script>
</head>

<body>
    <div class="container">
        <!-- ìƒë‹¨ í—¤ë” -->
        <div class="header">
            <h2>ê´€ë¦¬ì í˜ì´ì§€</h2>
            <div>
                <a href="/download_excel" class="btn btn-success">ğŸ“Š ì—‘ì…€ ë‹¤ìš´ë¡œë“œ</a>
                <a href="/logout" class="btn btn-secondary">ë¡œê·¸ì•„ì›ƒ</a>
            </div>
        </div>

        <!-- ê²€ìƒ‰ í•„í„° ì„¹ì…˜ -->
        <div class="filter-section">
            <form action="{{ url_for('admin.master_view') }}" method="get">
                <!-- ê²€ìƒ‰ì–´ -->
                <div class="row mb-3" style="display: flex; gap: 10px; align-items: flex-end;">
                    <div style="flex: 1;">
                        <input type="text" name="q" class="form-control" placeholder="ì´ë¦„ ë˜ëŠ” ì—°ë½ì²˜ ê²€ìƒ‰"
                            value="{{ search_query }}">
                        <input type="hidden" name="type" value="name"> <!-- ê¸°ë³¸ ê²€ìƒ‰ íƒ€ì… ìœ ì§€ -->
                    </div>
                </div>

                <!-- ìƒì„¸ í•„í„° ê·¸ë£¹ -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 15px;">
                    <div>
                        <label class="filter-group-title">ì„±ë³„</label>
                        <select name="gender" class="form-select">
                            <option value="">ì „ì²´</option>
                            <option value="ë‚¨" {% if filters.gender=='ë‚¨' %}selected{% endif %}>ë‚¨ì</option>
                            <option value="ì—¬" {% if filters.gender=='ì—¬' %}selected{% endif %}>ì—¬ì</option>
                        </select>
                    </div>
                    <div>
                        <label class="filter-group-title">ê·¼ë¬´í˜•íƒœ</label>
                        <select name="shift" class="form-select">
                            <option value="">ì „ì²´</option>
                            <option value="ê°€ëŠ¥" {% if filters.shift=='ê°€ëŠ¥' %}selected{% endif %}>êµëŒ€ ê°€ëŠ¥</option>
                            <option value="ë¶ˆê°€ëŠ¥" {% if filters.shift=='ë¶ˆê°€ëŠ¥' %}selected{% endif %}>êµëŒ€ ë¶ˆê°€</option>
                        </select>
                    </div>
                    <div>
                        <label class="filter-group-title">ì¢Œì‹ê·¼ë¬´</label>
                        <select name="posture" class="form-select">
                            <option value="">ì „ì²´</option>
                            <option value="ê°€ëŠ¥" {% if filters.posture=='ê°€ëŠ¥' %}selected{% endif %}>ê°€ëŠ¥</option>
                            <option value="ë¶ˆê°€ëŠ¥" {% if filters.posture=='ë¶ˆê°€ëŠ¥' %}selected{% endif %}>ë¶ˆê°€ëŠ¥</option>
                        </select>
                    </div>
                    <div>
                        <label class="filter-group-title">ì”ì—…/íŠ¹ê·¼</label>
                        <select name="overtime" class="form-select">
                            <option value="">ì „ì²´</option>
                            <option value="ê°€ëŠ¥" {% if filters.overtime=='ê°€ëŠ¥' %}selected{% endif %}>ê°€ëŠ¥</option>
                            <option value="ë¶ˆê°€ëŠ¥" {% if filters.overtime=='ë¶ˆê°€ëŠ¥' %}selected{% endif %}>ë¶ˆê°€ëŠ¥</option>
                        </select>
                    </div>
                    <div>
                        <label class="filter-group-title">ì ‘ìˆ˜ê¸°ê°„(ì‹œì‘)</label>
                        <input type="date" name="start_date" class="form-control" value="{{ start_date or '' }}">
                    </div>
                    <div>
                        <label class="filter-group-title">ì ‘ìˆ˜ê¸°ê°„(ì¢…ë£Œ)</label>
                        <input type="date" name="end_date" class="form-control" value="{{ end_date or '' }}">
                    </div>
                </div>

                <div style="margin-top: 20px; text-align: center;">
                    <button type="submit" class="btn btn-primary" style="width: 200px;">ğŸ” ì¡°ê±´ ê²€ìƒ‰</button>
                    <a href="{{ url_for('admin.master_view') }}" class="btn btn-outline"
                        style="margin-left: 10px;">ì´ˆê¸°í™”</a>
                </div>
            </form>
        </div>

        <!-- ë¦¬ìŠ¤íŠ¸ ì»¨íŠ¸ë¡¤ -->
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
            <h3 style="font-size: 1.2rem; margin: 0; font-weight: 700;">
                ì´ <span style="color: var(--primary-color);">{{ pagination.total }}</span>ëª… ì§€ì›
            </h3>
            <div>
                <button onclick="if(confirm('ì„ íƒí•œ í•­ëª©ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) document.getElementById('deleteForm').submit();"
                    class="btn btn-danger btn-sm">ğŸ—‘ï¸ ì„ íƒ ì‚­ì œ</button>
            </div>
        </div>

        <!-- ë°ì´í„° ë¦¬ìŠ¤íŠ¸ -->
        <form method="post" action="{{ url_for('admin.delete_selected') }}" id="deleteForm">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

            {% if not data %}
            <div style="text-align: center; padding: 60px; color: #999; border: 1px dashed #ddd; border-radius: 8px;">
                ì ‘ìˆ˜ëœ ì§€ì›ì„œê°€ ì—†ê±°ë‚˜ ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.
            </div>
            {% endif %}

            {% for entry in data %}
            <div class="card">
                <div class="card-header">
                    <div style="display: flex; align-items: center;">
                        <input type="checkbox" name="selected_ids" value="{{ entry.id }}"
                            style="transform: scale(1.2); margin-right: 12px;">
                        <span style="font-weight: 700; font-size: 1.1rem; margin-right: 8px;">{{ entry.info.name
                            }}</span>

                        {% if entry.info.gender == 'ë‚¨' %}
                        <span class="badge" style="background-color: #007bff;">ë‚¨</span>
                        {% elif entry.info.gender == 'ì—¬' %}
                        <span class="badge" style="background-color: #dc3545;">ì—¬</span>
                        {% endif %}

                        <span style="color: #999; font-size: 0.85rem; margin-left: auto;">
                            ì ‘ìˆ˜ì¼: {{ entry.timestamp }}
                        </span>
                    </div>
                </div>

                <div class="card-body">
                    <!-- ì‚¬ì§„ ì˜ì—­ -->
                    {% if entry.photo %}
                    <div class="applicant-photo">
                        <a href="/view_photo/{{ entry.photo }}" target="_blank">
                            <img src="/view_photo/{{ entry.photo }}">
                        </a>
                    </div>
                    {% else %}
                    <div class="applicant-photo">ì‚¬ì§„ì—†ìŒ</div>
                    {% endif %}

                    <!-- ì •ë³´ ì˜ì—­ -->
                    <div class="applicant-info">
                        <div class="row" style="display: flex; gap: 30px;">
                            <div style="flex: 1;">
                                <div class="info-row"><span class="label-badge">ìƒë…„ì›”ì¼</span> <span class="data-val">{{
                                        entry.info.birth }}</span></div>
                                <div class="info-row"><span class="label-badge">ì—°ë½ì²˜</span> <span class="data-val">{{
                                        entry.info.phone }}</span></div>
                                <div class="info-row"><span class="label-badge">ì£¼ì†Œ</span> <span class="data-val">{{
                                        entry.info.address }}</span></div>
                            </div>
                            <div style="flex: 1;">
                                <div class="info-row"><span class="label-badge">ì‹ ì²´</span> <span class="data-val">{{
                                        entry.body.height }}cm / {{ entry.body.weight }}kg</span></div>
                                <div class="info-row"><span class="label-badge">ê·¼ë¬´</span>
                                    <span class="data-val">
                                        êµëŒ€:{{ entry.work_condition.shift or '-' }} /
                                        ì¢Œì‹:{{ entry.work_condition.posture or '-' }} /
                                        ì”ì—…:{{ entry.work_condition.overtime or '-' }}
                                    </span>
                                </div>
                                <div class="info-row">
                                    <span class="label-badge">ì¼ì •</span>
                                    <span class="highlight">ë©´ì ‘: {{ entry.work_condition.interview_date or 'ë¯¸ì •' }}</span>
                                    /
                                    <span class="highlight">ì…ì‚¬: {{ entry.work_condition.start_date or 'ë¯¸ì •' }}</span>
                                </div>
                            </div>
                        </div>

                        <!-- ê²½ë ¥ í…Œì´ë¸” (ê°„ì†Œí™”) -->
                        <table class="career-table">
                            <thead>
                                <tr>
                                    <th style="width: 20%;">íšŒì‚¬ëª…</th>
                                    <th style="width: 25%;">ê¸°ê°„</th>
                                    <th style="width: 20%;">ì—…ë¬´</th>
                                    <th style="width: 35%;">í‡´ì‚¬ì‚¬ìœ </th>
                                </tr>
                            </thead>
                            <tbody>
                                {% if entry.career %}
                                {% for car in entry.career %}
                                <tr>
                                    <td>{{ car.company }}</td>
                                    <td>{{ car.start }}~{{ car.end }}</td>
                                    <td>{{ car.role }}</td>
                                    <td>{{ car.reason }}</td>
                                </tr>
                                {% endfor %}
                                {% else %}
                                <tr>
                                    <td colspan="4" style="color: #999;">ê²½ë ¥ ì‚¬í•­ ì—†ìŒ</td>
                                </tr>
                                {% endif %}
                            </tbody>
                        </table>

                        <!-- ë©”ëª¨ -->
                        <div class="memo-box">
                            <div style="display: flex; gap: 10px; align-items: center;">
                                <div style="font-weight: 700; font-size: 0.85rem; color: #888;">ê´€ë¦¬ì ë©”ëª¨</div>
                                <button type="button" id="btn-memo-{{ entry.id }}" onclick="saveMemo('{{ entry.id }}')"
                                    class="btn btn-secondary"
                                    style="height: 28px; font-size: 0.8rem; padding: 0 10px;">ì €ì¥</button>
                            </div>
                            <textarea id="memo-{{ entry.id }}" class="memo-textarea"
                                placeholder="íŠ¹ì´ì‚¬í•­ ì…ë ¥">{{ entry.memo }}</textarea>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </form>

        <!-- í˜ì´ì§€ë„¤ì´ì…˜ -->
        {% if pagination.total > 0 %}
        <div class="pagination">
            {% if pagination.has_prev %}
            <a href="javascript:goPage({{ pagination.prev_num }})" class="page-link">â€¹</a>
            {% endif %}

            {% for page_num in pagination.iter_pages(left_edge=1, right_edge=1, left_current=2, right_current=2) %}
            {% if page_num %}
            {% if page_num == pagination.page %}
            <span class="page-link active">{{ page_num }}</span>
            {% else %}
            <a href="javascript:goPage({{ page_num }})" class="page-link">{{ page_num }}</a>
            {% endif %}
            {% else %}
            <span class="page-link" style="border:none;">...</span>
            {% endif %}
            {% endfor %}

            {% if pagination.has_next %}
            <a href="javascript:goPage({{ pagination.next_num }})" class="page-link">â€º</a>
            {% endif %}
        </div>
        {% endif %}
    </div>
</body>

</html>
.btn {
padding: 8px 15px;
border: none;
border-radius: 5px;
cursor: pointer;
font-weight: bold;
text-decoration: none;
display: inline-flex;
justify-content: center;
align-items: center;
width: 160px;
/* ë²„íŠ¼ ë„ˆë¹„ ê³ ì • */
box-sizing: border-box;
/* íŒ¨ë”© í¬í•¨ ë„ˆë¹„ ê³„ì‚° */
height: 40px;
/* ë†’ì´ë„ ê³ ì •í•˜ì—¬ í†µì¼ê° ë¶€ì—¬ */
vertical-align: middle;
}

.btn-excel {
background: #28a745;
color: white;
}

.btn-delete {
background: #dc3545;
color: white;
}

.btn-logout {
background: #6c757d;
color: white;
}

.card {
border: 1px solid #ddd;
padding: 20px;
margin-bottom: 20px;
border-radius: 10px;
background: #fff;
position: relative;
}

.card-header {
display: flex;
justify-content: space-between;
align-items: center;
background: #f8f9fa;
padding: 10px;
margin: -20px -20px 15px -20px;
border-bottom: 1px solid #ddd;
border-radius: 10px 10px 0 0;
}

.info-group {
margin-bottom: 10px;
}

.label {
font-weight: bold;
color: #555;
display: inline-block;
width: 80px;
}

.photo-box {
position: absolute;
top: 60px;
right: 20px;
width: 100px;
height: 130px;
border: 1px solid #ddd;
}

.photo-box img {
width: 100%;
height: 100%;
object-fit: cover;
}

.career-table {
width: 100%;
border-collapse: collapse;
margin-top: 10px;
font-size: 0.9rem;
}

.career-table th,
.career-table td {
border: 1px solid #ddd;
padding: 5px;
text-align: center;
}

.career-table th {
background: #f1f3f5;
}

.checkbox-wrapper {
margin-right: 10px;
transform: scale(1.5);
}

.search-container {
background: #fff;
padding: 15px 20px;
margin-bottom: 20px;
border-radius: 10px;
border: 1px solid #ddd;
display: flex;
align-items: center;
gap: 10px;
}

.search-input {
padding: 8px 12px;
border: 1px solid #ccc;
border-radius: 5px;
flex-grow: 1;
}

.search-select {
padding: 8px;
border: 1px solid #ccc;
border-radius: 5px;
}

.btn-search {
background: #003057;
color: white;
width: 80px;
height: 35px;
}

.memo-section {
margin-top: 15px;
padding-top: 15px;
border-top: 1px dashed #ddd;
}

.memo-textarea {
width: 100%;
height: 60px;
padding: 10px;
border: 1px solid #ddd;
border-radius: 5px;
resize: none;
box-sizing: border-box;
background: #fffef0;
}

.btn-save-memo {
margin-top: 5px;
background: #6c757d;
color: white;
font-size: 0.8rem;
width: 100px;
height: 30px;
}
</style>
<script>
    function toggleAll(source) {
        var checkboxes = document.getElementsByName('selected_ids');
        for (var i = 0; i < checkboxes.length; i++) {
            checkboxes[i].checked = source.checked;
        }
    }

    async function saveMemo(appId) {
        const memoText = document.getElementById(`memo-${appId}`).value;
        const btn = event.target;
        const originalText = btn.innerText;

        btn.innerText = "ì €ì¥ ì¤‘...";
        btn.disabled = true;

        const formData = new FormData();
        formData.append('memo', memoText);
        formData.append('csrf_token', '{{ csrf_token() }}');

        try {
            const response = await fetch(`/update_memo/${appId}`, {
                method: 'POST',
                body: formData
            });
            const result = await response.json();
            if (result.success) {
                btn.innerText = "ì €ì¥ë¨!";
                btn.style.background = "#28a745";
                setTimeout(() => {
                    btn.innerText = originalText;
                    btn.style.background = "#6c757d";
                    btn.disabled = false;
                }, 2000);
            } else {
                alert("ì €ì¥ ì‹¤íŒ¨: " + result.message);
                btn.disabled = false;
                btn.innerText = originalText;
            }
        } catch (error) {
            console.error("Error saving memo:", error);
            alert("ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
            btn.disabled = false;
            btn.innerText = originalText;
        }
    }
</script>
</head>

<body>
    <div class="container">
        <div class="header">
            <h2 style="color:#003057; margin:0;">ê´€ë¦¬ì í˜ì´ì§€</h2>
            <div>
                <a href="/download_excel" class="btn btn-excel">ğŸ“Š ì—‘ì…€ ë‹¤ìš´ë¡œë“œ</a>
                <a href="/logout" class="btn btn-logout">ë¡œê·¸ì•„ì›ƒ</a>
            </div>
        </div>

        <!-- ê²€ìƒ‰ ë° ìƒë‹¨ ì •ë³´ -->
        <div class="row align-items-center mb-4">
            <div class="col-md-6">
                <h3 class="fw-bold text-primary">ì§€ì›ì ê´€ë¦¬ (ì´ {{ data|length }}ëª…)</h3>
            </div>
            <div class="col-md-6 text-end">
                <!-- ê²€ìƒ‰ í¼ -->
                <form action="{{ url_for('admin.master_view') }}" method="get" class="d-flex justify-content-end gap-2">
                    <select name="type" class="form-select w-auto">
                        <option value="name" {% if search_type=='name' %}selected{% endif %}>ì´ë¦„</option>
                        <option value="phone" {% if search_type=='phone' %}selected{% endif %}>ì—°ë½ì²˜</option>
                    </select>
                    <input type="text" name="q" class="form-control w-auto" placeholder="ê²€ìƒ‰ì–´ ì…ë ¥"
                        value="{{ search_query }}">
                    <button type="submit" class="btn btn-primary">ê²€ìƒ‰</button>
                    <button type="button" class="btn btn-secondary" data-bs-toggle="collapse"
                        data-bs-target="#detailedFilters">ìƒì„¸ê²€ìƒ‰</button>
                    <a href="{{ url_for('admin.master_view') }}" class="btn btn-outline-secondary">ì´ˆê¸°í™”</a>
                </form>
            </div>
        </div>

        <!-- ìƒì„¸ ê²€ìƒ‰ í•„í„° (ì ‘ì´ì‹) -->
        <div class="collapse mb-4" id="detailedFilters">
            <div class="card card-body bg-light">
                <form action="{{ url_for('admin.master_view') }}" method="get">
                    <div class="row g-3">
                        <div class="col-md-2">
                            <label class="form-label fw-bold">ì„±ë³„</label>
                            <select name="gender" class="form-select">
                                <option value="">ì „ì²´</option>
                                <option value="ë‚¨" {% if filters and filters.gender=='ë‚¨' %}selected{% endif %}>ë‚¨ì
                                </option>
                                <option value="ì—¬" {% if filters and filters.gender=='ì—¬' %}selected{% endif %}>ì—¬ì
                                </option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <label class="form-label fw-bold">êµëŒ€ê·¼ë¬´</label>
                            <select name="shift" class="form-select">
                                <option value="">ì „ì²´</option>
                                <option value="ê°€ëŠ¥" {% if filters and filters.shift=='ê°€ëŠ¥' %}selected{% endif %}>ê°€ëŠ¥
                                </option>
                                <option value="ë¶ˆê°€ëŠ¥" {% if filters and filters.shift=='ë¶ˆê°€ëŠ¥' %}selected{% endif %}>ë¶ˆê°€ëŠ¥
                                </option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <label class="form-label fw-bold">ì¢Œì‹ê·¼ë¬´</label>
                            <select name="posture" class="form-select">
                                <option value="">ì „ì²´</option>
                                <option value="ê°€ëŠ¥" {% if filters and filters.posture=='ê°€ëŠ¥' %}selected{% endif %}>ê°€ëŠ¥
                                </option>
                                <option value="ë¶ˆê°€ëŠ¥" {% if filters and filters.posture=='ë¶ˆê°€ëŠ¥' %}selected{% endif %}>
                                    ë¶ˆê°€ëŠ¥</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <label class="form-label fw-bold">ì”ì—…</label>
                            <select name="overtime" class="form-select">
                                <option value="">ì „ì²´</option>
                                <option value="ê°€ëŠ¥" {% if filters and filters.overtime=='ê°€ëŠ¥' %}selected{% endif %}>ê°€ëŠ¥
                                </option>
                                <option value="ë¶ˆê°€ëŠ¥" {% if filters and filters.overtime=='ë¶ˆê°€ëŠ¥' %}selected{% endif %}>
                                    ë¶ˆê°€ëŠ¥</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <label class="form-label fw-bold">íŠ¹ê·¼</label>
                            <select name="holiday" class="form-select">
                                <option value="">ì „ì²´</option>
                                <option value="ê°€ëŠ¥" {% if filters and filters.holiday=='ê°€ëŠ¥' %}selected{% endif %}>ê°€ëŠ¥
                                </option>
                                <option value="ë¶ˆê°€ëŠ¥" {% if filters and filters.holiday=='ë¶ˆê°€ëŠ¥' %}selected{% endif %}>
                                    ë¶ˆê°€ëŠ¥</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <label class="form-label fw-bold">ê²€ìƒ‰ ì‹¤í–‰</label>
                            <button type="submit" class="btn btn-primary w-100">í•„í„° ì ìš©</button>
                        </div>
                    </div>
                    <div class="row g-3 mt-2">
                        <div class="col-md-3">
                            <label class="form-label fw-bold">ì ‘ìˆ˜ì¼ ê¸°ê°„ ì„¤ì •</label>
                            <div class="input-group">
                                <input type="date" name="start_date" class="form-control"
                                    value="{{ start_date if start_date else '' }}">
                                <span class="input-group-text">~</span>
                                <input type="date" name="end_date" class="form-control"
                                    value="{{ end_date if end_date else '' }}">
                            </div>
                        </div>
                        <div class="col-md-2">
                            <label class="form-label fw-bold">ê°€ë¶ˆ í¬ë§</label>
                            <select name="advance_pay" class="form-select">
                                <option value="">ì „ì²´</option>
                                <option value="í¬ë§í•¨" {% if filters and filters.advance_pay=='í¬ë§í•¨' %}selected{% endif %}>
                                    í¬ë§í•¨</option>
                                <option value="í¬ë§ì•ˆí•¨" {% if filters and filters.advance_pay=='í¬ë§ì•ˆí•¨' %}selected{% endif
                                    %}>í¬ë§ì•ˆí•¨</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <label class="form-label fw-bold">ê¸‰ì—¬ í˜•íƒœ</label>
                            <select name="insurance_type" class="form-select">
                                <option value="">ì „ì²´</option>
                                <option value="4ëŒ€ë³´í—˜" {% if filters and filters.insurance_type=='4ëŒ€ë³´í—˜' %}selected{% endif
                                    %}>4ëŒ€ë³´í—˜</option>
                                <option value="3.3%" {% if filters and filters.insurance_type=='3.3%' %}selected{% endif
                                    %}>3.3%</option>
                            </select>
                        </div>
                    </div>
                </form>
            </div>
        </div>


        <div style="margin-bottom: 15px;">
            <button onclick="if(confirm('ì„ íƒí•œ í•­ëª©ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) document.getElementById('deleteForm').submit();"
                class="btn btn-delete">ğŸ—‘ï¸ ì„ íƒ ì‚­ì œ</button>
            <label style="margin-left: 15px; cursor: pointer;">
                <input type="checkbox" onclick="toggleAll(this)"> ì „ì²´ ì„ íƒ
            </label>
        </div>

        <form method="post" action="{{ url_for('admin.delete_selected') }}" id="deleteForm">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

            {% if not data %}
            <p style="text-align:center; padding:50px;">ì ‘ìˆ˜ëœ ì§€ì›ì„œê°€ ì—†ìŠµë‹ˆë‹¤.</p>
            {% endif %}

            {% for entry in data %}
            <div class="card">
                <div class="card-header">
                    <div>
                        <input type="checkbox" name="selected_ids" value="{{ entry.id }}" class="checkbox-wrapper">
                        <span style="font-weight:bold; font-size:1.1rem;">{{ entry.info.name }} ({{ entry.info.birth
                            }})</span>
                        {% if entry.info.gender %}
                        <span
                            class="badge {% if entry.info.gender == 'ë‚¨' %}bg-primary{% else %}bg-danger{% endif %} ms-2"
                            style="font-size: 0.8rem; opacity: 0.8; color: white;">{{ entry.info.gender }}</span>
                        {% endif %}
                        <span style="color:#888; font-size:0.9rem; margin-left:10px;">ì ‘ìˆ˜: {{ entry.timestamp
                            }}</span>
                    </div>
                </div>

                <!-- Card Body Wrapper (implicit in previous design but making it explicit helps structure) -->
                <div style="padding: 10px;">
                    {% if entry.photo %}
                    <div class="photo-box">
                        <a href="/view_photo/{{ entry.photo }}" target="_blank">
                            <img src="/view_photo/{{ entry.photo }}">
                        </a>
                    </div>
                    {% else %}
                    <div class="photo-box"
                        style="display:flex; align-items:center; justify-content:center; background:#eee; color:#aaa; font-size:0.8rem;">
                        ì‚¬ì§„ì—†ìŒ
                    </div>
                    {% endif %}

                    <div style="width: 75%;">
                        <div class="info-group"><span class="label">ì—°ë½ì²˜</span> {{ entry.info.phone }}</div>
                        <div class="info-group"><span class="label">ì£¼ì†Œ</span> {{ entry.info.address }}</div>
                        <div class="info-group"><span class="label">ì‹ ì²´</span> {{ entry.body.height }}cm / {{
                            entry.body.weight }}kg / {{ entry.body.vision }} / {{ entry.body.shoes }} / {{
                            entry.body.tshirt }}</div>
                        <div class="info-group">
                            <span class="label">ê·¼ë¬´ì¡°ê±´</span>
                            êµëŒ€: {{ entry.work_condition.shift or 'ì—†ìŒ' }} /
                            ìì„¸: {{ entry.work_condition.posture or 'ì—†ìŒ' }} /
                            ì”ì—…: {{ entry.work_condition.overtime or 'ì—†ìŒ' }} /
                            íŠ¹ê·¼: {{ entry.work_condition.holiday or 'ì—†ìŒ' }}
                        </div>
                        <div class="info-group">
                            <span class="label">í¬ë§ì¼ì •</span>
                            ë©´ì ‘ê°€ëŠ¥: <span style="color:#0056b3; font-weight:bold;">{{
                                entry.work_condition.interview_date or 'ê¸°ë¡ì—†ìŒ' }}</span> /
                            ì…ì‚¬í¬ë§: <span style="color:#0056b3; font-weight:bold;">{{ entry.work_condition.start_date
                                or 'ê¸°ë¡ì—†ìŒ' }}</span>
                        </div>
                        <div class="info-group">
                            <span class="label">ê¸°íƒ€</span>
                            ê°€ë¶ˆ: <span style="font-weight:bold;">{{ entry.extra.advance_pay if entry.extra and
                                entry.extra.advance_pay else 'ë¹„í¬ë§' }}</span> /
                            ê¸‰ì—¬í˜•íƒœ: <span style="font-weight:bold;">{{ entry.extra.insurance_type if entry.extra and
                                entry.extra.insurance_type else '4ëŒ€ë³´í—˜' }}</span>
                        </div>

                        <table class="career-table">
                            <tr>
                                <th width="25%">íšŒì‚¬ëª…</th>
                                <th width="30%">ê¸°ê°„</th>
                                <th width="20%">ë‹´ë‹¹ì—…ë¬´</th>
                                <th width="25%">í‡´ì‚¬ì‚¬ìœ </th>
                            </tr>
                            {% if entry.career %}
                            {% for car in entry.career %}
                            <tr>
                                <td>{{ car.company }}</td>
                                <td>{{ car.start }}~{{ car.end }}</td>
                                <td>{{ car.role }}</td>
                                <td>{{ car.reason }}</td>
                            </tr>
                            {% endfor %}
                            {% else %}
                            <tr>
                                <td colspan="4">ê²½ë ¥ ì‚¬í•­ ì—†ìŒ</td>
                            </tr>
                            {% endif %}
                        </table>
                    </div>

                    <div class="memo-section">
                        <div style="font-weight:bold; margin-bottom:5px; font-size:0.9rem;">ê´€ë¦¬ì ë©”ëª¨</div>
                        <textarea id="memo-{{ entry.id }}" class="memo-textarea"
                            placeholder="ë©”ëª¨ë¥¼ ì…ë ¥í•˜ì„¸ìš”...">{{ entry.memo }}</textarea>
                        <button type="button" class="btn btn-save-memo" onclick="saveMemo('{{ entry.id }}')">ë©”ëª¨
                            ì €ì¥</button>
                    </div>
                </div>
            </div>
            {% endfor %}
        </form>
    </div>
</body>

</html>