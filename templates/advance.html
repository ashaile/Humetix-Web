<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HUMETIX - ê°€ë¶ˆ ì‹ ì²­</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700;900&display=swap"
        rel="stylesheet">
    <style>
        :root {
            --bg: #f8f7f4;
            --bg2: #fff;
            --bg3: #f0efec;
            --text: #1a1a1a;
            --text2: #6b6b6b;
            --accent: #e85d26;
            --accent-bg: #fef3ee;
            --border: #e8e6e1;
            --success: #22a867;
            --success-bg: #edfbf3;
            --radius: 12px;
            --radius-sm: 8px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans KR', sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
        }

        .container {
            max-width: 520px;
            margin: 0 auto;
            padding: 32px 24px;
        }

        .page-title {
            font-size: 26px;
            font-weight: 800;
            letter-spacing: -.5px;
            margin-bottom: 8px;
        }

        .page-desc {
            color: var(--text2);
            font-size: 14px;
            margin-bottom: 28px;
        }

        .nav-links {
            display: flex;
            gap: 10px;
            margin-bottom: 28px;
            flex-wrap: wrap;
            padding: 16px 20px;
            background: var(--bg2);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            justify-content: center;
        }

        .nav-links a {
            text-decoration: none;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 10px 20px;
            border-radius: var(--radius-sm);
            font-size: 14px;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: all .2s;
            font-family: inherit;
            white-space: nowrap;
            text-decoration: none;
        }

        .btn-primary {
            background: var(--accent);
            color: #fff;
        }

        .btn-primary:hover {
            background: #d14e1a;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(232, 93, 38, .3);
        }

        .btn-outline {
            background: var(--bg2);
            color: var(--text);
            border: 1px solid var(--border);
        }

        .btn-sm {
            padding: 7px 14px;
            font-size: 13px;
        }

        .input-card {
            background: var(--bg2);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 28px;
        }

        .input-card h3 {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-label {
            display: block;
            font-size: 12px;
            font-weight: 600;
            color: var(--text2);
            margin-bottom: 6px;
            text-transform: uppercase;
            letter-spacing: .5px;
        }

        .form-input,
        .form-select,
        .form-textarea {
            width: 100%;
            padding: 10px 14px;
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            font-size: 14px;
            font-family: inherit;
            background: var(--bg);
            color: var(--text);
            transition: border-color .2s;
        }

        .form-textarea {
            min-height: 80px;
            resize: vertical;
        }

        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(232, 93, 38, .1);
        }

        .success-msg {
            background: var(--success-bg);
            border: 1px solid #86efac;
            border-radius: var(--radius-sm);
            padding: 14px 16px;
            font-size: 14px;
            color: #166534;
            font-weight: 500;
            margin-bottom: 16px;
            text-align: center;
        }

        .error-msg {
            background: #fef2f2;
            border: 1px solid #fca5a5;
            border-radius: var(--radius-sm);
            padding: 14px 16px;
            font-size: 14px;
            color: #dc2626;
            font-weight: 500;
            margin-bottom: 16px;
        }

        .info-box {
            background: var(--accent-bg);
            border-radius: var(--radius-sm);
            padding: 10px 14px;
            font-size: 12px;
            color: var(--accent);
            margin-bottom: 16px;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="nav-links">
            <a href="/" class="btn btn-outline">ğŸ  í™ˆ</a>
            <a href="/attendance" class="btn btn-outline">ğŸ“‹ ê·¼íƒœê´€ë¦¬</a>
            <a href="/advance" class="btn btn-primary">ğŸ’° ê°€ë¶ˆì‹ ì²­</a>
        </div>

        <h1 class="page-title">ê°€ë¶ˆ ì‹ ì²­</h1>
        <p class="page-desc">ê°€ë¶ˆì„ ì‹ ì²­í•©ë‹ˆë‹¤. ê´€ë¦¬ì ìŠ¹ì¸ í›„ ê¸‰ì—¬ì—ì„œ ì°¨ê°ë©ë‹ˆë‹¤.</p>

        {% if success %}
        <div class="success-msg">âœ… ê°€ë¶ˆ ì‹ ì²­ì´ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤. ê´€ë¦¬ì ìŠ¹ì¸ì„ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.</div>
        {% endif %}

        {% if errors %}
        <div class="error-msg">
            {% for e in errors %}<div>â€¢ {{ e }}</div>{% endfor %}
        </div>
        {% endif %}

        {% if not success %}
        <div class="input-card">
            <h3>ğŸ¦ ê°€ë¶ˆ ì‹ ì²­ì„œ</h3>
            <div class="info-box">
                â„¹ï¸ <b>ê°€ë¶ˆ í•œë„ ì•ˆë‚´</b><br>
                - ì£¼ê°„ ê·¼ë¬´ì: ìµœëŒ€ 300,000ì›<br>
                - êµëŒ€ ê·¼ë¬´ì: ìµœëŒ€ 500,000ì›
            </div>
            <form method="post" action="/advance" onsubmit="return validateAdvance()">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

                <div class="form-group">
                    <label class="form-label">ìƒë…„ì›”ì¼ (YYMMDD)</label>
                    <input type="text" name="birth_date" class="form-input" placeholder="ì˜ˆ: 900101" maxlength="6"
                        required value="{{ form.get('birth_date','') if form else '' }}">
                </div>

                <div class="form-group">
                    <label class="form-label">ì´ë¦„</label>
                    <input type="text" name="emp_name" class="form-input" required
                        value="{{ form.get('emp_name','') if form else '' }}">
                </div>

                <div class="form-group">
                    <label class="form-label">ê·¼ë¬´ í˜•íƒœ</label>
                    <div style="display:flex;gap:12px;margin-top:4px;">
                        <label style="display:flex;align-items:center;gap:6px;font-size:14px;cursor:pointer;">
                            <input type="radio" name="work_type" value="weekly" checked onchange="updateLimit()"> ì£¼ê°„ ê·¼ë¬´
                        </label>
                        <label style="display:flex;align-items:center;gap:6px;font-size:14px;cursor:pointer;">
                            <input type="radio" name="work_type" value="shift" onchange="updateLimit()"> êµëŒ€ ê·¼ë¬´
                        </label>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">ì‹ ì²­ ì›”</label>
                    <input type="month" name="request_month" class="form-input" required
                        value="{{ form.get('request_month','') if form else '' }}">
                </div>

                <div class="form-group">
                    <label class="form-label">ì‹ ì²­ ê¸ˆì•¡ (ì›)</label>
                    <input type="number" name="amount" id="amount-input" class="form-input" required min="1"
                        placeholder="ê¸ˆì•¡ ì…ë ¥" value="{{ form.get('amount','') if form else '' }}">
                    <div id="limit-msg" style="font-size:12px;color:var(--text2);margin-top:4px;">
                        * í˜„ì¬ ì ìš© í•œë„: 300,000ì›
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">ì‚¬ìœ  (ì„ íƒ)</label>
                    <textarea name="reason" class="form-textarea"
                        placeholder="í•œë„ ì¦ì•¡ í•„ìš” ì‹œ ì‘ì„±í•´ì£¼ì„¸ìš”">{{ form.get('reason','') if form else '' }}</textarea>
                </div>

                <button type="submit" class="btn btn-primary" style="width:100%;justify-content:center;padding:12px;">
                    ê°€ë¶ˆ ì‹ ì²­
                </button>
            </form>
        </div>

        <script>
            // ì´ˆê¸° í•œë„ ì„¤ì • ë° ë™ì  ë³€ê²½
            const LIMIT_WEEKLY = 300000;
            const LIMIT_SHIFT = 500000;

            function updateLimit() {
                const type = document.querySelector('input[name="work_type"]:checked').value;
                const msg = document.getElementById('limit-msg');
                const limit = type === 'weekly' ? LIMIT_WEEKLY : LIMIT_SHIFT;
                msg.innerHTML = `* í˜„ì¬ ì ìš© í•œë„: ${limit.toLocaleString()}ì›`;
            }

            function validateAdvance() {
                const type = document.querySelector('input[name="work_type"]:checked').value;
                const amount = parseInt(document.getElementById('amount-input').value) || 0;
                const limit = type === 'weekly' ? LIMIT_WEEKLY : LIMIT_SHIFT;

                if (amount > limit) {
                    alert(`ì„ íƒí•˜ì‹  ê·¼ë¬´ í˜•íƒœì˜ ê°€ë¶ˆ í•œë„ëŠ” ${limit.toLocaleString()}ì›ì…ë‹ˆë‹¤.\ní•œë„ë¥¼ ì´ˆê³¼í•˜ì—¬ ì‹ ì²­í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`);
                    return false;
                }
                return true;
            }

            // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸° ìƒíƒœ ë°˜ì˜
            window.onload = function () {
                updateLimit();
            }
        </script>
        {% endif %}
    </div>
</body>

</html>