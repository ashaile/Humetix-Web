{% extends "base_admin.html" %}

{% block admin_title %}HUMETIX - 운영캘린더{% endblock %}
{% block page_title %}운영캘린더 관리{% endblock %}
{% block page_desc %}기본 규칙: 토요일=무급휴무일, 일요일/공휴일=유급휴무일{% endblock %}

{% block page_css %}
.month-bar {
    display: flex;
    gap: 8px;
    margin-bottom: 16px;
    align-items: center;
    flex-wrap: wrap;
}
.badge-workday {
    background: #eefaf2;
    color: #15803d;
}
.badge-paidleave {
    background: #fef3ee;
    color: #c2410c;
}
.badge-unpaidleave {
    background: #eef2ff;
    color: #3730a3;
}
@media (max-width: 768px) {
    .month-bar { flex-direction: column; align-items: stretch; }
}
{% endblock %}

{% block content %}
<form method="get" action="/admin/attendance-calendar" class="month-bar">
    <input type="month" name="month" value="{{ month }}" class="form-input">
    <button type="submit" class="btn btn-primary btn-sm">조회</button>
    <a href="/admin/attendance" class="btn btn-outline btn-sm">근무현황으로 돌아가기</a>
</form>

<div class="table-wrap">
    <div class="table-scroll">
        <table>
            <thead>
                <tr>
                    <th>날짜</th>
                    <th>요일</th>
                    <th>기본 판정</th>
                    <th>운영캘린더</th>
                    <th>메모</th>
                    <th>최종 판정</th>
                    <th>저장</th>
                </tr>
            </thead>
            <tbody>
                {% for row in days %}
                <tr>
                    <td class="mono">{{ row.date.strftime('%Y-%m-%d') }}</td>
                    <td>{{ ['월','화','수','목','금','토','일'][row.date.weekday()] }}</td>
                    <td>
                        {% if row.default_type == 'paid_leave' %}
                        <span class="badge badge-paidleave">유급휴무일</span>
                        {% elif row.default_type == 'unpaid_leave' %}
                        <span class="badge badge-unpaidleave">무급휴무일</span>
                        {% else %}
                        <span class="badge badge-workday">일반근무일</span>
                        {% endif %}
                    </td>
                    <td>
                        <select name="day_type" class="form-input" form="calendar-form-{{ loop.index }}">
                            <option value="default" {% if row.override_type=='default' %}selected{% endif %}>기본 규칙 사용</option>
                            <option value="workday" {% if row.override_type=='workday' %}selected{% endif %}>일반근무일</option>
                            <option value="paid_leave" {% if row.override_type=='paid_leave' %}selected{% endif %}>유급휴무일</option>
                            <option value="unpaid_leave" {% if row.override_type=='unpaid_leave' %}selected{% endif %}>무급휴무일</option>
                        </select>
                    </td>
                    <td>
                        <input type="text" name="note" class="form-input" maxlength="200" value="{{ row.note }}"
                            placeholder="사유 메모" form="calendar-form-{{ loop.index }}">
                    </td>
                    <td>
                        {% if row.effective_type == 'paid_leave' %}
                        <span class="badge badge-paidleave">유급휴무일</span>
                        {% elif row.effective_type == 'unpaid_leave' %}
                        <span class="badge badge-unpaidleave">무급휴무일</span>
                        {% else %}
                        <span class="badge badge-workday">일반근무일</span>
                        {% endif %}
                    </td>
                    <td>
                        <form id="calendar-form-{{ loop.index }}" method="post" action="/admin/attendance-calendar">
                            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                            <input type="hidden" name="month" value="{{ month }}">
                            <input type="hidden" name="work_date" value="{{ row.date.strftime('%Y-%m-%d') }}">
                        </form>
                        <button type="submit" class="btn btn-primary btn-sm" form="calendar-form-{{ loop.index }}">저장</button>
                    </td>
                </tr>
                {% endfor %}
                {% if not days %}
                <tr>
                    <td colspan="7" style="text-align:center;color:var(--text2);padding:24px;">표시할 데이터가 없습니다.</td>
                </tr>
                {% endif %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}
